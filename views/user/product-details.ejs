

<%- include("../partials/user/header") %>
<!-- Breadcrumb -->
<section class="py-3 bg-light">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mb-0">
        <li class="breadcrumb-item"><a href="/" class="text-decoration-none text-muted">Home</a></li>
        <li class="breadcrumb-item"><a href="/shopPage" class="text-decoration-none text-muted">Shop</a></li>
        <li class="breadcrumb-item"><a href="/shopPage" class="text-decoration-none text-muted"><%= product.category.name %></a></li>
        <li class="breadcrumb-item active" aria-current="page"><%= product.title %></li>
      </ol>
    </nav>
  </div>
</section>

<!-- Product Details -->
<section class="py-5 bg-white">
  <div class="container">
    <div class="row g-5">
      <!-- Product Images -->
      <div class="col-lg-5">
        <div class="row">
          <!-- Thumbnails - Vertical on left side -->
          <div class="col-2">
            <div class="d-flex flex-column thumbnails-container">
              <img src="<%= product.mainImage || '/api/placeholder/600/800' %>" alt="<%= product.title %> - Cover" class="thumbnail active" onclick="changeImage(this, '<%= product.mainImage || '/api/placeholder/600/800' %>')" />
              <% if (product.subImages && product.subImages.length > 0) { %>
                <% product.subImages.forEach((subImage, index) => { %>
                  <img src="<%= subImage || '/api/placeholder/600/800' %>" alt="<%= product.title %> - Image <%= index + 1 %>" class="thumbnail" onclick="changeImage(this, '<%= subImage || '/api/placeholder/600/800' %>')" />
                <% }) %>
              <% } %>
            </div>
          </div>
          
          <!-- Main Image -->
          <div class="col-10">
            <div class="mb-3 zoom-container" id="zoomContainer">
              <img src="<%= product.mainImage || '/api/placeholder/600/800' %>" alt="<%= product.title %>" class="main-image" id="mainImage" />
            </div>
          </div>
        </div>
      </div>
      
      <!-- Product Info -->
      <div class="col-lg-7">
        <div class="book-details">
          <h1 class="fs-2 fw-bold mb-1"><%= product.title %></h1>
          <p class="fs-5 mb-3">by <a href="#" class="text-decoration-none"><%= product.author %></a></p>
          
          <div class="book-meta">
            <div class="book-meta-item">
              <i class="ri-book-open-line book-meta-icon"></i>
              <span> <%= product.pages %> pages</span>
            </div>
            <div class="book-meta-item">
              <i class="ri-translate-2 book-meta-icon"></i>
              <span><%= product.language %></span>
            </div>
            <div class="book-meta-item">
              <i class="ri-calendar-line book-meta-icon"></i>
              <span>Published: <%= product.publishedDate ? new Date(product.publishedDate).toLocaleDateString() : 'N/A' %></span>
            </div>
            <div class="book-meta-item">
              <i class="ri-barcode-line book-meta-icon"></i>
              <span>ISBN: <%= product.isbn || 'N/A' %></span>
            </div>
          </div>
          
          <div class="price-section">
            <h2 class="fs-3 fw-bold mb-0">₹<%= product.salePrice %></h2>
            <% if (product.regularPrice > product.salePrice) { %>
              <span class="fs-5 original-price">₹<%= product.regularPrice %></span>
              <span class="discount-badge">
                <%= Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100) %>% OFF
              </span>
            <% } %>
          </div>
          
          <div class="mb-3">
            <% if (product.stock > 10) { %>
              <span class="stock-status in-stock">
                <i class="ri-checkbox-circle-line me-1"></i> In Stock (<%= product.stock %> copies available)
              </span>
            <% } else if (product.stock > 0) { %>
              <span class="stock-status low-stock">
                <i class="ri-alert-line me-1"></i> Low Stock (<%= product.stock %> copies left)
              </span>
            <% } else { %>
              <span class="stock-status out-of-stock">
                <i class="ri-close-circle-line me-1"></i> Out of Stock
              </span>
            <% } %>
          </div>
          
          <p class="text-muted mb-4">
            <%= product.description %>
          </p>
          
          <div class="d-flex flex-column gap-4">
            <div>
              <label class="form-label fw-medium mb-2">Quantity</label>
              <div class="quantity-selector">
                <button class="quantity-btn" onclick="decrementQuantity()">
                  <i class="ri-subtract-line"></i>
                </button>
                <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="<%= product.stock %>" />
                <button class="quantity-btn" onclick="incrementQuantity()">
                  <i class="ri-add-line"></i>
                </button>
              </div>
            </div>
            
            <div class="action-buttons">
              <button class="btn btn-primary btn-add-to-cart py-3" <%= product.stock === 0 ? 'disabled' : '' %>>
                <i class="ri-shopping-cart-line"></i>
                <span>Add to Cart</span>
              </button>
              <button class="btn-wishlist">
                <i class="ri-heart-line"></i>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Social Sharing -->
        <div>
          <p class="fw-medium mb-2">Share this book:</p>
          <div class="d-flex gap-2">
            <a href="#" class="social-icon"><i class="ri-facebook-line"></i></a>
            <a href="#" class="social-icon"><i class="ri-twitter-x-line"></i></a>
            <a href="#" class="social-icon"><i class="ri-pinterest-line"></i></a>
            <a href="#" class="social-icon"><i class="ri-instagram-line"></i></a>
            <a href="#" class="social-icon"><i class="ri-mail-line"></i></a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Product Tabs -->
    <div class="product-tabs">
      <ul class="nav nav-tabs" id="productTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="description-tab" data-bs-toggle="tab" data-bs-target="#description" type="button" role="tab" aria-controls="description" aria-selected="true">Description</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">Details</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">Reviews</button>
        </li>
      </ul>
      <div class="tab-content" id="productTabsContent">
        <div class="tab-pane fade show active" id="description" role="tabpanel" aria-labelledby="description-tab">
          <div class="row">
            <div class="col-lg-12">
              <h3 class="fs-4 fw-bold mb-4">About the Book</h3>
              <p class="mb-4"><%= product.description %></p>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
          <h3 class="fs-4 fw-bold mb-4">Book Specifications</h3>
          <div class="book-specs">
            <div class="book-spec">
              <span class="book-spec-label">Title</span>
              <span class="book-spec-value"><%= product.title %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">Author</span>
              <span class="book-spec-value"><%= product.author %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">Publication Date</span>
              <span class="book-spec-value"><%= product.publishedDate ? new Date(product.publishedDate).toLocaleDateString() : 'N/A' %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">Language</span>
              <span class="book-spec-value"><%= product.language %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">Pages</span>
              <span class="book-spec-value"><%= product.pages %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">ISBN</span>
              <span class="book-spec-value"><%= product.isbn || 'N/A' %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">Category</span>
              <span class="book-spec-value"><%= product.category.name %></span>
            </div>
            <div class="book-spec">
              <span class="book-spec-label">Publisher</span>
              <span class="book-spec-value"><%= product.publisher %></span>
            </div>
          </div>
        </div>
        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
          <div class="row">
            <div class="col-lg-12">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="fs-4 fw-bold mb-0">Customer Reviews</h3>
                <button class="btn btn-outline-dark">Write a Review</button>
              </div>
              <p class="text-muted">No reviews yet. Be the first to review this book!</p>
              <!-- Add dynamic reviews here when implementing review functionality -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Related Products Section -->
    <div class="related-products">
      <h3 class="fs-3 fw-bold mb-4">You May Also Like</h3>
      <div class="row g-4">
        <% if (relatedProducts && relatedProducts.length > 0) { %>
          <% relatedProducts.forEach(relatedProduct => { %>
            <div class="col-sm-6 col-md-4 col-lg-3">
              <div class="product-card bg-white h-100">
                <div class="product-image-container">
                  <% 
                    const now = new Date();
                    const createdAt = new Date(relatedProduct.createdAt);
                    const diffDays = (now - createdAt) / (1000 * 60 * 60 * 24);
                    const isNew = diffDays <= 30;
                  %>
                  <% if (isNew) { %>
                    <span class="product-tag">New</span>
                  <% } %>
                  <a href="/products/<%= relatedProduct._id %>" class="text-decoration-none">
                    <img src="<%= relatedProduct.mainImage || '/api/placeholder/600/800' %>" alt="<%= relatedProduct.title %>" class="product-image" />
                  </a>
                  <div class="product-actions">
                    <button class="action-btn" title="Quick view">
                      <i class="ri-eye-line"></i>
                    </button>
                    <button class="action-btn" title="Add to wishlist">
                      <i class="ri-heart-line"></i>
                    </button>
                    <button class="action-btn" title="Add to cart">
                      <i class="ri-shopping-cart-line"></i>
                    </button>
                  </div>
                </div>
                <div class="p-3">
                  <h3 class="fs-5 fw-semibold mb-1">
                    <a href="/products/<%= relatedProduct._id %>" class="text-dark text-decoration-none"><%= relatedProduct.title %></a>
                  </h3>
                  <p class="text-muted small mb-2"><%= relatedProduct.author %></p>
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="fw-bold">₹<%= relatedProduct.salePrice %></span>
                    <button class="add-to-cart border-0">
                      <i class="ri-shopping-cart-line"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="col-12 text-center">
            <p class="text-muted">No related products available.</p>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<%- include("../partials/user/footer") %>

<style>
  body {
    font-family: "Inter", sans-serif;
    color: #1a1a1a;
  }
  .paper-texture {
    background-image: url('https://readdy.ai/api/search-image?query=Extremely%20subtle%20and%20minimal%20paper%20texture%2C%20almost%20completely%20white%20with%20very%20faint%20natural%20fiber%20patterns%20visible%20only%20upon%20close%20inspection.%20The%20texture%20is%20incredibly%20delicate%20and%20refined%2C%20providing%20just%20a%20hint%20of%20organic%20material%20quality%20while%20maintaining%20a%20clean%2C%20sophisticated%20appearance.%20Perfect%20for%20a%20minimalist%20design%20background%20that%20needs%20just%20a%20touch%20of%20warmth%20and%20depth%20without%20any%20distracting%20elements.&width=200&height=200&seq=123457&orientation=squarish');
    background-repeat: repeat;
  }
  
  /* Product Details Specific Styles */
  .main-image {
    width: 100%;
    height: auto;
    border-radius: 0.5rem;
    object-fit: cover;
  }
  
  .thumbnail {
    width: 100%;
    height: auto;
    object-fit: cover;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 2px solid transparent;
    margin-bottom: 10px;
  }
  
  .thumbnail.active {
    border-color: #000;
  }
  
  .book-details {
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .book-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
  }
  
  .book-meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .book-meta-icon {
    color: #6b7280;
  }
  
  .price-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  
  .original-price {
    text-decoration: line-through;
    color: #6b7280;
  }
  
  .discount-badge {
    background-color: #000;
    color: #fff;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }
  
  .quantity-selector {
    display: flex;
    align-items: center;
    border: 1px solid #e5e5e5;
    border-radius: 0.5rem;
    overflow: hidden;
    width: fit-content;
  }
  
  .quantity-btn {
    background: none;
    border: none;
    width: 2.5rem;
    height: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .quantity-btn:hover {
    background-color: #f5f5f5;
  }
  
  .quantity-input {
    width: 3rem;
    text-align: center;
    border: none;
    border-left: 1px solid #e5e5e5;
    border-right: 1px solid #e5e5e5;
    height: 2.5rem;
  }
  
  .quantity-input:focus {
    outline: none;
  }
  
  .action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  
  .btn-add-to-cart {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
  
  .btn-wishlist {
    width: 3rem;
    height: 3rem;
    border-radius: 0.5rem;
    border: 1px solid #e5e5e5;
    background: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .btn-wishlist:hover {
    background-color: #f5f5f5;
  }
  
  .product-tabs {
    margin-top: 3rem;
  }
  
  .nav-tabs {
    border-bottom: 1px solid #e5e5e5;
  }
  
  .nav-tabs .nav-link {
    border: none;
    border-bottom: 2px solid transparent;
    color: #6b7280;
    font-weight: 500;
    padding: 0.75rem 1.5rem;
  }
  
  .nav-tabs .nav-link.active {
    border-bottom-color: #000;
    color: #000;
  }
  
  .tab-content {
    padding: 2rem 0;
  }
  
  .book-specs {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
  }
  
  .book-spec {
    display: flex;
    flex-direction: column;
  }
  
  .book-spec-label {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 0.25rem;
  }
  
  .book-spec-value {
    font-weight: 500;
  }
  
  .related-products {
    margin-top: 4rem;
  }
  
  .stock-status {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
  }
  
  .in-stock {
    background-color: #ecfdf5;
    color: #047857;
  }
  
  .low-stock {
    background-color: #fffbeb;
    color: #b45309;
  }
  
  .out-of-stock {
    background-color: #fef2f2;
    color: #b91c1c;
  }
  
  /* Add to cart button styling - similar to shop page */
  .add-to-cart {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    background-color: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    border: none;
  }
  
  .add-to-cart:hover {
    background-color: #333;
  }
  
  /* Product actions for related products */
  .product-actions {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.9);
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.5rem;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
  }
  
  .product-card:hover .product-actions {
    opacity: 1;
    transform: translateY(0);
  }
  
  .action-btn {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    border: none;
    background-color: #fff;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .action-btn:hover {
    background-color: #000;
    color: #fff;
  }
  
  .product-image-container {
    position: relative;
    overflow: hidden;
  }
  
  .product-image {
    width: 100%;
    height: auto;
    aspect-ratio: 1/1.2;
    object-fit: cover;
    transition: transform 0.3s ease;
  }
  
  .product-card:hover .product-image {
    transform: scale(1.05);
  }
  
  .product-tag {
    position: absolute;
    top: 10px;
    left: 10px;
    background-color: #000;
    color: #fff;
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 2px;
    z-index: 1;
  }
  
  @media (max-width: 767.98px) {
    .thumbnails-container {
      display: flex;
      overflow-x: auto;
      gap: 0.5rem;
      padding-bottom: 0.5rem;
    }
    
    .thumbnail {
      width: 60px;
      height: 80px;
      flex-shrink: 0;
    }
    
    .action-buttons {
      flex-direction: column;
    }
    
    .btn-wishlist {
      width: 100%;
    }
    
    .product-actions {
      opacity: 1;
      transform: translateY(0);
    }
    
    .col-2 {
      width: 20%;
    }
    .col-10 {
      width: 80%;
    }
    .thumbnail {
      margin-bottom: 5px !important;
    }
  }
  /* Add these styles to your existing style section */

.zoom-container {
  position: relative;
  overflow: hidden;
  cursor: zoom-in;
  border-radius: 0.5rem;
  width: 100%;
}

.zoom-container img {
  display: block;
  width: 100%;
  height: auto;
  transition: transform 0.2s ease;
}

.zoom-container::after {
  content: '';
  position: absolute;
  top: 10px;
  right: 10px;
  width: 24px;
  height: 24px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='rgba(0,0,0,0.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3Cline x1='11' y1='8' x2='11' y2='14'%3E%3C/line%3E%3Cline x1='8' y1='11' x2='14' y2='11'%3E%3C/line%3E%3C/svg%3E");
  opacity: 0.6;
  transition: opacity 0.3s ease;
}

.zoom-container:hover::after {
  opacity: 0;
}

@media (max-width: 767.98px) {
  .zoom-container::after {
    display: none;
  }
}
</style>

<script>
  // Image gallery functionality
  function changeImage(thumbnail, imageSrc) {
    document.getElementById('mainImage').src = imageSrc;
    const thumbnails = document.querySelectorAll('.thumbnail');
    thumbnails.forEach(thumb => thumb.classList.remove('active'));
    thumbnail.classList.add('active');
  }
  
  // Quantity selector functionality
  function incrementQuantity() {
    const quantityInput = document.getElementById('quantity');
    const currentValue = parseInt(quantityInput.value);
    const maxValue = parseInt(quantityInput.getAttribute('max'));
    if (currentValue < maxValue) {
      quantityInput.value = currentValue + 1;
    }
  }
  
  function decrementQuantity() {
    const quantityInput = document.getElementById('quantity');
    const currentValue = parseInt(quantityInput.value);
    if (currentValue > 1) {
      quantityInput.value = currentValue - 1;
    }
  }
  
 // Image zoom functionality
function initImageZoom() {
  const mainImage = document.getElementById('mainImage');
  const zoomContainer = document.getElementById('zoomContainer');
  
  if (!mainImage || !zoomContainer) return;
  
  let isZooming = false;
  const zoomLevel = 2.5; // Adjust zoom level as needed
  
  zoomContainer.addEventListener('mouseenter', function() {
    isZooming = true;
    mainImage.style.transition = 'transform 0.1s ease';
  });
  
  zoomContainer.addEventListener('mouseleave', function() {
    isZooming = false;
    mainImage.style.transform = 'scale(1)';
    mainImage.style.transformOrigin = 'center center';
  });
  
  zoomContainer.addEventListener('mousemove', function(e) {
    if (!isZooming) return;
    
    // Get cursor position relative to the container
    const rect = zoomContainer.getBoundingClientRect();
    const x = (e.clientX - rect.left) / rect.width;
    const y = (e.clientY - rect.top) / rect.height;
    
    // Set transform origin based on cursor position
    mainImage.style.transformOrigin = `${x * 100}% ${y * 100}%`;
    mainImage.style.transform = `scale(${zoomLevel})`;
  });
}

// Initialize Bootstrap tabs and zoom functionality
document.addEventListener('DOMContentLoaded', function() {
  // Initialize image zoom
  initImageZoom();
  
  // Initialize Bootstrap tabs
  const triggerTabList = [].slice.call(document.querySelectorAll('#productTabs button'));
  triggerTabList.forEach(function(triggerEl) {
    const tabTrigger = new bootstrap.Tab(triggerEl);
    triggerEl.addEventListener('click', function(event) {
      event.preventDefault();
      tabTrigger.show();
    });
  });
});
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>