<%- include("../partials/user/header") %>

<!-- Wishlist Header Section -->
<section class="py-5 bg-light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h1 class="display-5 fw-bold mb-2">Your Wishlist</h1>
        <p class="text-muted mb-0">Stories you've saved for later</p>
      </div>
    </div>
  </div>
</section>

<!-- Wishlist Content Section -->
<section class="py-5">
  <div class="container">
    <div class="row g-5">
      <!-- Wishlist Items -->
      <div class="col-lg-8">
        <!-- Empty Wishlist State -->
        <div class="empty-wishlist text-center py-5 d-none">
          <div class="mb-4">
            <i class="ri-heart-line" style="font-size: 4rem; color: #ccc;"></i>
          </div>
          <h3 class="fs-4 fw-semibold mb-3">Your wishlist is empty</h3>
          <p class="text-muted mb-4">Save items you love to find them easily later</p>
          <a href="/shopPage" class="btn btn-dark px-4 py-2">Explore Books</a>
        </div>

        <!-- Wishlist Items List -->
        <div class="wishlist-items">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fs-4 fw-bold">Saved Items (4)</h2>
            <button class="btn btn-link text-dark p-0 text-decoration-none">Clear Wishlist</button>
          </div>

          <!-- Wishlist Item 1 -->
          <div class="wishlist-item bg-white p-4 mb-3 rounded shadow-sm">
            <div class="row align-items-center">
              <div class="col-md-2 col-4 mb-3 mb-md-0">
                <img src="/api/placeholder/150/200" alt="Book Cover" class="img-fluid rounded" />
              </div>
              <div class="col-md-6 col-8 mb-3 mb-md-0">
                <h3 class="fs-5 fw-semibold mb-1">The Invisible Life of Addie LaRue</h3>
                <p class="text-muted small mb-1">V.E. Schwab</p>
                <p class="small mb-0">Hardcover, Special Edition</p>
                <span class="stock-status in-stock">
                  <i class="ri-checkbox-circle-line me-1"></i> In Stock (12 copies available)
                </span>
              </div>
              <div class="col-md-2 col-6">
                <div class="d-flex flex-column">
                  <span class="fw-bold mb-2">₹1,199</span>
                  <span class="text-decoration-line-through text-muted small">₹1,499</span>
                </div>
              </div>
              <div class="col-md-2 col-6 text-end">
                <div class="d-flex flex-column align-items-end">
                  <button class="btn btn-dark btn-sm mb-2">Add to Cart</button>
                  <button class="btn btn-link text-danger p-0 small text-decoration-none">Remove</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Wishlist Item 2 -->
          <div class="wishlist-item bg-white p-4 mb-3 rounded shadow-sm">
            <div class="row align-items-center">
              <div class="col-md-2 col-4 mb-3 mb-md-0">
                <img src="/api/placeholder/150/200" alt="Book Cover" class="img-fluid rounded" />
              </div>
              <div class="col-md-6 col-8 mb-3 mb-md-0">
                <h3 class="fs-5 fw-semibold mb-1">Klara and the Sun</h3>
                <p class="text-muted small mb-1">Kazuo Ishiguro</p>
                <p class="small mb-0">Paperback</p>
                <span class="stock-status low-stock">
                  <i class="ri-alert-line me-1"></i> Low Stock (2 copies left)
                </span>
              </div>
              <div class="col-md-2 col-6">
                <div class="d-flex flex-column">
                  <span class="fw-bold mb-2">₹599</span>
                </div>
              </div>
              <div class="col-md-2 col-6 text-end">
                <div class="d-flex flex-column align-items-end">
                  <button class="btn btn-dark btn-sm mb-2">Add to Cart</button>
                  <button class="btn btn-link text-danger p-0 small text-decoration-none">Remove</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Wishlist Item 3 -->
          <div class="wishlist-item bg-white p-4 mb-3 rounded shadow-sm">
            <div class="row align-items-center">
              <div class="col-md-2 col-4 mb-3 mb-md-0">
                <img src="/api/placeholder/150/200" alt="Book Cover" class="img-fluid rounded" />
              </div>
              <div class="col-md-6 col-8 mb-3 mb-md-0">
                <h3 class="fs-5 fw-semibold mb-1">The Seven Husbands of Evelyn Hugo</h3>
                <p class="text-muted small mb-1">Taylor Jenkins Reid</p>
                <p class="small mb-0">Hardcover</p>
                <span class="stock-status out-of-stock">
                  <i class="ri-close-circle-line me-1"></i> Out of Stock
                </span>
              </div>
              <div class="col-md-2 col-6">
                <div class="d-flex flex-column">
                  <span class="fw-bold mb-2">₹849</span>
                </div>
              </div>
              <div class="col-md-2 col-6 text-end">
                <div class="d-flex flex-column align-items-end">
                  <button class="btn btn-dark btn-sm mb-2" disabled>Add to Cart</button>
                  <button class="btn btn-link text-danger p-0 small text-decoration-none">Remove</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Wishlist Item 4 -->
          <div class="wishlist-item bg-white p-4 mb-3 rounded shadow-sm">
            <div class="row align-items-center">
              <div class="col-md-2 col-4 mb-3 mb-md-0">
                <img src="/api/placeholder/150/200" alt="Book Cover" class="img-fluid rounded" />
              </div>
              <div class="col-md-6 col-8 mb-3 mb-md-0">
                <h3 class="fs-5 fw-semibold mb-1">Project Hail Mary</h3>
                <p class="text-muted small mb-1">Andy Weir</p>
                <p class="small mb-0">Paperback</p>
                <span class="stock-status in-stock">
                  <i class="ri-checkbox-circle-line me-1"></i> In Stock (20+ copies available)
                </span>
              </div>
              <div class="col-md-2 col-6">
                <div class="d-flex flex-column">
                  <span class="fw-bold mb-2">₹749</span>
                  <span class="text-decoration-line-through text-muted small">₹899</span>
                </div>
              </div>
              <div class="col-md-2 col-6 text-end">
                <div class="d-flex flex-column align-items-end">
                  <button class="btn btn-dark btn-sm mb-2">Add to Cart</button>
                  <button class="btn btn-link text-danger p-0 small text-decoration-none">Remove</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Continue Shopping -->
        <div class="mt-4">
          <a href="/shopPage" class="text-dark d-flex align-items-center text-decoration-none">
            <i class="ri-arrow-left-line me-2"></i> Continue Shopping
          </a>
        </div>
      </div>

      <!-- Wishlist Summary -->
      <div class="col-lg-4">
        <div class="wishlist-summary bg-white p-4 rounded shadow-sm" id="wishlistSummary">
          <h2 class="fs-4 fw-bold mb-4">Wishlist Summary</h2>
          
          <!-- Stats -->
          <div class="d-flex justify-content-between mb-3">
            <span>Total Items</span>
            <span class="fw-semibold">4</span>
          </div>
          
          <div class="d-flex justify-content-between mb-3">
            <span>In Stock Items</span>
            <span class="fw-semibold">2</span>
          </div>
          
          <div class="d-flex justify-content-between mb-3">
            <span>Low Stock Items</span>
            <span class="fw-semibold">1</span>
          </div>
          
          <div class="d-flex justify-content-between mb-4">
            <span>Out of Stock Items</span>
            <span class="fw-semibold">1</span>
          </div>
          
          <hr class="my-3">
          
          <!-- Actions -->
          <button class="btn btn-dark w-100 py-3 fw-medium mb-3">Add All Available to Cart</button>
          <button class="btn btn-outline-dark w-100 py-3 fw-medium">Share Wishlist</button>
          
          <!-- Notification -->
          <div class="mt-4 p-3 bg-light rounded">
            <div class="d-flex align-items-start">
              <i class="ri-notification-3-line me-3 mt-1" style="color: #000;"></i>
              <div>
                <h3 class="fs-6 fw-semibold mb-2">Get notified</h3>
                <p class="small text-muted mb-0">We'll let you know when out-of-stock items become available again.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Recently Viewed Section -->
<section class="py-5 bg-light">
  <div class="container">
    <h2 class="fs-2 fw-bold mb-4">Recently Viewed</h2>
    <div class="row g-4">
      <!-- Book 1 -->
      <div class="col-6 col-md-3">
        <div class="product-card bg-white h-100">
          <div class="product-image-container">
            <a href="#" class="text-decoration-none">
              <img src="/api/placeholder/600/800" alt="Book Cover" class="product-image" />
            </a>
          </div>
          <div class="p-3">
            <h3 class="fs-5 fw-semibold mb-1">
              <a href="#" class="text-dark text-decoration-none">Circe</a>
            </h3>
            <p class="text-muted small mb-2">Madeline Miller</p>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="fw-bold">₹649</span>
                <span class="stock-status in-stock">
                  <i class="ri-checkbox-circle-line me-1"></i> In Stock
                </span>
              </div>
              <button class="add-to-cart border-0">
                <i class="ri-add-line"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Book 2 -->
      <div class="col-6 col-md-3">
        <div class="product-card bg-white h-100">
          <div class="product-image-container">
            <span class="product-tag">New</span>
            <a href="#" class="text-decoration-none">
              <img src="/api/placeholder/600/800" alt="Book Cover" class="product-image" />
            </a>
          </div>
          <div class="p-3">
            <h3 class="fs-5 fw-semibold mb-1">
              <a href="#" class="text-dark text-decoration-none">The Midnight Library</a>
            </h3>
            <p class="text-muted small mb-2">Matt Haig</p>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="fw-bold">₹799</span>
                <span class="stock-status low-stock">
                  <i class="ri-alert-line me-1"></i> Low Stock
                </span>
              </div>
              <button class="add-to-cart border-0">
                <i class="ri-add-line"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Book 3 -->
      <div class="col-6 col-md-3">
        <div class="product-card bg-white h-100">
          <div class="product-image-container">
            <a href="#" class="text-decoration-none">
              <img src="/api/placeholder/600/800" alt="Book Cover" class="product-image" />
            </a>
          </div>
          <div class="p-3">
            <h3 class="fs-5 fw-semibold mb-1">
              <a href="#" class="text-dark text-decoration-none">Educated</a>
            </h3>
            <p class="text-muted small mb-2">Tara Westover</p>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="fw-bold">₹549</span>
                <span class="stock-status in-stock">
                  <i class="ri-checkbox-circle-line me-1"></i> In Stock
                </span>
              </div>
              <button class="add-to-cart border-0">
                <i class="ri-add-line"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Book 4 -->
      <div class="col-6 col-md-3">
        <div class="product-card bg-white h-100">
          <div class="product-image-container">
            <a href="#" class="text-decoration-none">
              <img src="/api/placeholder/600/800" alt="Book Cover" class="product-image" />
            </a>
          </div>
          <div class="p-3">
            <h3 class="fs-5 fw-semibold mb-1">
              <a href="#" class="text-dark text-decoration-none">The Silent Patient</a>
            </h3>
            <p class="text-muted small mb-2">Alex Michaelides</p>
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="fw-bold">₹599</span>
                <span class="stock-status in-stock">
                  <i class="ri-checkbox-circle-line me-1"></i> In Stock
                </span>
              </div>
              <button class="add-to-cart border-0">
                <i class="ri-add-line"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<%- include("../partials/user/footer") %>

<style>
  body {
    font-family: "Inter", sans-serif;
    color: #1a1a1a;
    background-color: #f9f9f9;
  }
  
  .wishlist-item {
    transition: all 0.2s ease;
  }
  
  .wishlist-item:hover {
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  }
  
  .btn-dark {
    background-color: #000;
    border-color: #000;
  }
  
  .btn-dark:hover {
    background-color: #333;
    border-color: #333;
  }
  
  .btn-outline-dark {
    color: #000;
    border-color: #000;
  }
  
  .btn-outline-dark:hover {
    background-color: #000;
    color: #fff;
  }
  
  .form-control:focus {
    box-shadow: none;
    border-color: #000;
  }
  
  .product-image-container {
    height: 16rem;
    overflow: hidden;
    position: relative;
  }
  
  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top;
    transition: transform 0.5s ease;
  }
  
  .product-card:hover .product-image {
    transform: scale(1.05);
  }
  
  .product-tag {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    z-index: 10;
    background-color: #000;
    color: #fff;
    font-size: 0.75rem;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
  }
  
  .add-to-cart {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 9999px;
    background-color: #000;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  
  .add-to-cart:hover {
    background-color: #333;
  }
  
  /* Stock status styles from shop page */
  .stock-status {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    margin-top: 0.5rem;
  }
  
  .in-stock {
    background-color: #ecfdf5;
    color: #047857;
  }
  
  .low-stock {
    background-color: #fffbeb;
    color: #b45309;
  }
  
  .out-of-stock {
    background-color: #fef2f2;
    color: #b91c1c;
  }
  
  /* Fix for wishlist summary position */
  #wishlistSummary.fixed {
    position: fixed;
    top: 80px; /* Adjust based on your header height */
    width: inherit;
    max-width: inherit;
  }
  
  @media (max-width: 767.98px) {
    #wishlistSummary.fixed {
      position: static !important;
    }
    
    /* Make stock status more compact on mobile */
    .stock-status {
      padding: 0.15rem 0.5rem;
      font-size: 0.75rem;
    }
    
    /* Stack buttons on mobile */
    .wishlist-item .btn-dark {
      margin-bottom: 0.5rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // For demo purposes - toggle empty wishlist state
    const clearWishlistBtn = document.querySelector('button.btn-link');
    const emptyWishlist = document.querySelector('.empty-wishlist');
    const wishlistItems = document.querySelector('.wishlist-items');
    const wishlistSummary = document.querySelector('.wishlist-summary');
    
    if (clearWishlistBtn) {
      clearWishlistBtn.addEventListener('click', function() {
        emptyWishlist.classList.remove('d-none');
        wishlistItems.classList.add('d-none');
        wishlistSummary.classList.add('d-none');
      });
    }
    
    // Individual item removal
    const removeButtons = document.querySelectorAll('.btn-link.text-danger');
    removeButtons.forEach(button => {
      button.addEventListener('click', function() {
        const wishlistItem = this.closest('.wishlist-item');
        wishlistItem.style.opacity = '0';
        setTimeout(() => {
          wishlistItem.remove();
          
          // If no items left, show empty wishlist
          if (document.querySelectorAll('.wishlist-item').length === 0) {
            emptyWishlist.classList.remove('d-none');
            wishlistItems.classList.add('d-none');
            wishlistSummary.classList.add('d-none');
          }
          
          // Update counts
          updateWishlistCounts();
        }, 300);
      });
    });
    
    // Add to cart functionality
    const addToCartButtons = document.querySelectorAll('.wishlist-item .btn-dark');
    addToCartButtons.forEach(button => {
      button.addEventListener('click', function() {
        const wishlistItem = this.closest('.wishlist-item');
        
        // Show a brief "Added to cart" message
        const originalText = this.textContent;
        this.textContent = "Added ✓";
        this.disabled = true;
        
        setTimeout(() => {
          // Remove from wishlist
          wishlistItem.style.opacity = '0';
          setTimeout(() => {
            wishlistItem.remove();
            
            // If no items left, show empty wishlist
            if (document.querySelectorAll('.wishlist-item').length === 0) {
              emptyWishlist.classList.remove('d-none');
              wishlistItems.classList.add('d-none');
              wishlistSummary.classList.add('d-none');
            }
            
            // Update counts
            updateWishlistCounts();
          }, 300);
        }, 1000);
      });
    });
    
    // Add all to cart button
    const addAllButton = document.querySelector('#wishlistSummary .btn-dark');
    if (addAllButton) {
      addAllButton.addEventListener('click', function() {
        const availableItems = document.querySelectorAll('.wishlist-item:not(:has(.out-of-stock))');
        
        // Show a brief "Added to cart" message
        const originalText = this.textContent;
        this.textContent = "Added All Available ✓";
        this.disabled = true;
        
        // Remove all available items
        setTimeout(() => {
          availableItems.forEach(item => {
            item.style.opacity = '0';
          });
          
          setTimeout(() => {
            availableItems.forEach(item => {
              item.remove();
            });
            
            // If no items left, show empty wishlist
            if (document.querySelectorAll('.wishlist-item').length === 0) {
              emptyWishlist.classList.remove('d-none');
              wishlistItems.classList.add('d-none');
              wishlistSummary.classList.add('d-none');
            } else {
              // Update counts
              updateWishlistCounts();
              
              // Reset button
              this.textContent = originalText;
              this.disabled = false;
            }
          }, 300);
        }, 1000);
      });
    }
    
    // Function to update wishlist counts
    function updateWishlistCounts() {
      const totalItems = document.querySelectorAll('.wishlist-item').length;
      const inStockItems = document.querySelectorAll('.wishlist-item .in-stock').length;
      const lowStockItems = document.querySelectorAll('.wishlist-item .low-stock').length;
      const outOfStockItems = document.querySelectorAll('.wishlist-item .out-of-stock').length;
      
      // Update header count
      const headerCount = document.querySelector('.wishlist-items h2');
      if (headerCount) {
        headerCount.textContent = `Saved Items (${totalItems})`;
      }
      
      // Update summary counts
      const summaryCountElements = document.querySelectorAll('#wishlistSummary .d-flex .fw-semibold');
      if (summaryCountElements.length >= 4) {
        summaryCountElements[0].textContent = totalItems;
        summaryCountElements[1].textContent = inStockItems;
        summaryCountElements[2].textContent = lowStockItems;
        summaryCountElements[3].textContent = outOfStockItems;
      }
    }
    
    // Fix for wishlist summary position when scrolling
    const wishlistSummaryElement = document.getElementById('wishlistSummary');
    if (wishlistSummaryElement) {
      const wishlistSummaryParent = wishlistSummaryElement.parentElement;
      const wishlistSummaryWidth = wishlistSummaryElement.offsetWidth;
      const headerHeight = document.querySelector('header') ? document.querySelector('header').offsetHeight : 0;
      
      // Variables to store original position
      let wishlistSummaryOriginalTop = wishlistSummaryElement.getBoundingClientRect().top + window.pageYOffset;
      let wishlistSummaryOriginalBottom = wishlistSummaryParent.getBoundingClientRect().bottom + window.pageYOffset;
      
      function handleScroll() {
        // Only apply sticky behavior on desktop
        if (window.innerWidth >= 992) {
          const scrollY = window.pageYOffset;
          const wishlistSummaryHeight = wishlistSummaryElement.offsetHeight;
          
          // Recalculate parent bottom position as it might change
          wishlistSummaryOriginalBottom = wishlistSummaryParent.getBoundingClientRect().bottom + window.pageYOffset;
          
          // If we've scrolled past the original position of the summary
          if (scrollY > wishlistSummaryOriginalTop - headerHeight - 20) {
            // Check if the summary would go beyond its container
            if (scrollY + headerHeight + wishlistSummaryHeight + 20 < wishlistSummaryOriginalBottom) {
              wishlistSummaryElement.classList.add('fixed');
              wishlistSummaryElement.style.width = wishlistSummaryWidth + 'px';
              wishlistSummaryElement.style.top = (headerHeight + 20) + 'px'; // Add some padding
            } else {
              // Allow the summary to scroll normally at the bottom of its container
              wishlistSummaryElement.classList.remove('fixed');
              wishlistSummaryElement.style.width = '';
              wishlistSummaryElement.style.top = '';
            }
          } else {
            // Reset to original position
            wishlistSummaryElement.classList.remove('fixed');
            wishlistSummaryElement.style.width = '';
            wishlistSummaryElement.style.top = '';
          }
        }
      }
      
      // Initial calculation
      window.addEventListener('load', function() {
        wishlistSummaryOriginalTop = wishlistSummaryElement.getBoundingClientRect().top + window.pageYOffset;
        handleScroll();
      });
      
      // Handle scroll events
      window.addEventListener('scroll', handleScroll);
      
      // Handle resize events (recalculate dimensions)
      window.addEventListener('resize', function() {
        if (window.innerWidth < 992) {
          wishlistSummaryElement.classList.remove('fixed');
          wishlistSummaryElement.style.width = '';
          wishlistSummaryElement.style.top = '';
        } else {
          wishlistSummaryOriginalTop = wishlistSummaryElement.getBoundingClientRect().top + window.pageYOffset;
          wishlistSummaryWidth = wishlistSummaryParent.offsetWidth;
          handleScroll();
        }
      });
    }
    
    // Add to cart buttons in Recently Viewed section
    const recentlyViewedAddButtons = document.querySelectorAll('.product-card .add-to-cart');
    recentlyViewedAddButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Visual feedback
        const originalColor = this.style.backgroundColor;
        this.style.backgroundColor = '#047857';
        
        setTimeout(() => {
          this.style.backgroundColor = originalColor;
        }, 500);
      });
    });
  });
</script>